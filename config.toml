# Phi-Backend 配置文件

[server]
# 服务器监听地址
host = "0.0.0.0"
# 服务器监听端口
port = 3939

[api]
# API 路由前缀
prefix = "/api/v1"

[resources]
# 资源文件夹路径（相对于项目根目录）
base_path = "./resources"
# Phigros 曲绘仓库 URL
illustration_repo = "https://github.com/Catrong/phi-plugin-ill"
# 曲绘文件夹名
illustration_folder = "ill"
# info 数据目录（包含 difficulty.csv）
info_path = "./info"

[logging]
# 日志级别: trace, debug, info, warn, error
level = "info"
# 日志输出格式: full, compact, pretty, json
format = "full"

[branding]
# 右下角自定义文字（留空则不显示）
footer_text = "Powered by lilith.xtower.site"

[stats]
# 是否启用统计
enabled = true
# 存储类型
storage = "sqlite"
# SQLite 路径
sqlite_path = "./resources/usage_stats.db"
# 启用 WAL
sqlite_wal = true
# 批量大小
batch_size = 100
# 刷新间隔（毫秒）
flush_interval_ms = 1000
# 热数据保留天数
retention_hot_days = 180
# 每日聚合/归档时间（本地时区）
daily_aggregate_time = "04:00"
[stats.archive]
parquet = true
dir = "./resources/stats/v1/events"
compress = "zstd"

[watermark]
# 显式水印：在卡片上展示 U 标记
explicit_badge = true
# 隐式水印：PNG 首像素写入可追踪标记
implicit_pixel = true
# 静态解除口令（留空表示关闭）
unlock_static = ""
# 是否启用动态口令（打印当前窗口口令在日志中）
unlock_dynamic = true
# 动态口令盐值
dynamic_salt = "phi"
# 动态口令有效期（秒）
dynamic_ttl_secs = 600
# 动态口令可选密钥（与盐值共同参与hash）
dynamic_secret = ""
# 动态口令长度（从SHA-256十六进制哈希前缀截取）
dynamic_length = 32

[shutdown]
# 优雅退出超时时间（秒）
timeout_secs = 10
# 是否启用强制退出
force_quit = true
# 强制退出前的等待时间（秒）
force_delay_secs = 10

[shutdown.watchdog]
# 是否启用systemd看门狗（仅在Linux下生效）
enabled = true
# 看门狗超时时间（秒）
timeout_secs = 60
# 心跳间隔时间（秒）
interval_secs = 10

# 图片渲染与缓存（性能调优）
[image]
# 栅格化速度优先（可能略降画质）
optimize_speed = false
# 启用 BN/单曲图片缓存
cache_enabled = true
# 缓存容量（字节）
cache_max_bytes = 104857600
# 缓存 TTL/TTI（秒）
cache_ttl_secs = 60
cache_tti_secs = 30
# 并发渲染许可数（0 = 自动 = CPU 核心数）
max_parallel = 0

# TapTap API 配置
[taptap.cn]
# 大陆版 - 设备码请求端点 (保持不变)
device_code_endpoint = "https://www.taptap.com/oauth2/v1/device/code"
# 大陆版 - Token交换端点 (保持不变)
token_endpoint = "https://www.taptap.cn/oauth2/v1/token"
# 大陆版 - 用户基本信息端点 (保持不变)
user_info_endpoint = "https://open.tapapis.cn/account/basic-info/v1"
# 大陆版 - LeanCloud API Base URL (保持不变)
leancloud_base_url = "https://rak3ffdi.cloud.tds1.tapapis.cn/1.1"
# 大陆版 - LeanCloud App ID (保持不变)
leancloud_app_id = "rAK3FfdieFob2Nn8Am"
# 大陆版 - LeanCloud App Key (保持不变)
leancloud_app_key = "Qr9AEqtuoSVS3zeD6iVbM4ZC0AtkJcQ89tywVyi0"

[taptap.global]
# 国际版 - 设备码请求端点 (.io 是国际版标准域名)
device_code_endpoint = "https://www.taptap.io/oauth2/v1/device/code"
# 国际版 - Token交换端点
token_endpoint = "https://www.taptap.io/oauth2/v1/token"
# 国际版 - 用户基本信息端点
user_info_endpoint = "https://open.tapapis.io/account/basic-info/v1"
# 国际版 - LeanCloud API Base URL 
leancloud_base_url = "https://kviehlel.cloud.ap-sg.tapapis.com/1.1"
# 国际版 - LeanCloud App ID 
leancloud_app_id = "kviehleldgxsagpozb"
# 国际版 - LeanCloud App Key 
leancloud_app_key = "tG9CTm0LDD736k9HMM9lBZrbeBGRmUkjSfNLDNib"

[taptap]
# 默认版本：cn 或 global
default_version = "cn"